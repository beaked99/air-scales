{% extends 'base.html.twig' %}

{% block title %}Hello DashboardController!{% endblock %}

{% block body %}
<h1>Your Devices</h1>

{% if devices is empty %}
  <p>No devices found for your account.</p>
{% else %}
  <ul>
    {% for device in devices %}
      <li>
        <strong>ID:</strong> {{ device.id }}<br>
        <strong>MAC:</strong> {{ device.macAddress }}<br>

        {# check if user has access history #}
        {% set access = null %}
        {% for record in accessRecords %}
          {% if record.device.id == device.id %}
            {% set access = record %}
          {% endif %}
        {% endfor %}

        {% if access %}
          First seen: {{ access.firstSeenAt|date('Y-m-d H:i') }}<br>
          Last connected: {{ access.lastConnectedAt|date('Y-m-d H:i') }}<br>
          <a href="{{ path('unlink_device', { id: device.id }) }}">Unlink</a>
        {% else %}
          <em>You purchased this device but havenâ€™t connected to it yet.</em><br>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endif %}


{% endblock %}
